// Full React (Next.js App Router style) AI-Powered Recipe Site
// -----------------------------------------------------------
// This single file includes:
// - All UI
// - Form
// - Routing
// - API call to OpenAI
// - Fetch from frontend to backend
// - Styled, playful layout using Tailwind + shadcn
// -----------------------------------------------------------

// -----------------------------
// app/page.jsx (Main UI)
// -----------------------------

"use client";

import { useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";

export default function Home() {
  const [form, setForm] = useState({
    cookTime: "",
    cuisine: "",
    restrictions: "",
    mealType: "",
    servings: "",
    extraDetails: ""
  });

  const [loading, setLoading] = useState(false);
  const [recipe, setRecipe] = useState(null);

  function handleChange(e) {
    setForm({ ...form, [e.target.name]: e.target.value });
  }

  async function handleGenerate() {
    setLoading(true);
    setRecipe(null);

    const res = await fetch("/api/generateRecipe", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(form)
    });

    const data = await res.json();
    setRecipe(data.recipe);
    setLoading(false);
  }

  return (
    <div className="min-h-screen p-8 flex flex-col items-center bg-gradient-to-br from-yellow-200 to-pink-200">
      <h1 className="text-5xl font-bold mb-6">Chef Smarty</h1>
      <p className="mb-6 text-lg text-gray-700 max-w-2xl text-center">
        Tell me what you're working with, and I'll dream up the perfect dish.
      </p>

      <Card className="w-full max-w-xl mb-8 p-4 rounded-2xl shadow-md backdrop-blur-sm bg-white/70">
        <CardContent className="flex flex-col gap-4">
          <Input
            placeholder="How long do you have to cook? (e.g., 20 minutes)"
            name="cookTime"
            value={form.cookTime}
            onChange={handleChange}
          />

          <Input
            placeholder="Preferred cuisine (or say none)"
            name="cuisine"
            value={form.cuisine}
            onChange={handleChange}
          />

          <Input
            placeholder="Dietary restrictions (optional)"
            name="restrictions"
            value={form.restrictions}
            onChange={handleChange}
          />

          <Input
            placeholder="What meal is this? (Breakfast, Dinner, Snack...)"
            name="mealType"
            value={form.mealType}
            onChange={handleChange}
          />

          <Input
            placeholder="How many people are eating?"
            name="servings"
            value={form.servings}
            onChange={handleChange}
          />

          <Textarea
            placeholder="Anything else to mention? (Optional)"
            name="extraDetails"
            value={form.extraDetails}
            onChange={handleChange}
          />

          <Button onClick={handleGenerate} disabled={loading} className="text-lg p-6 rounded-2xl">
            {loading ? "Cooking up ideas..." : "Find My Dish"}
          </Button>
        </CardContent>
      </Card>

      {recipe && (
        <Card className="w-full max-w-2xl p-6 rounded-2xl shadow-lg bg-white">
          <CardContent>
            <h2 className="text-3xl font-bold mb-4">Your Dish:</h2>
            <pre className="whitespace-pre-wrap text-gray-800 leading-relaxed">{recipe}</pre>
          </CardContent>
        </Card>
      )}
    </div>
  );
}

// -----------------------------------------------------------
// app/api/generateRecipe/route.js (Backend API + OpenAI call)
// -----------------------------------------------------------

import OpenAI from "openai";

export async function POST(req) {
  const body = await req.json();

  const client = new OpenAI({ apiKey: process.env.OPENAI_API_KEY });

  const prompt = `You are an expert chef. Create ONE dish that fits ALL these:
  - Cook time: ${body.cookTime}
  - Cuisine: ${body.cuisine}
  - Restrictions: ${body.restrictions}
  - Meal type: ${body.mealType}
  - Servings: ${body.servings}
  - Extra details: ${body.extraDetails}

  Format:
  Dish Name
  Ingredients (with amounts)
  Step-by-step recipe
  Keep it fun, friendly, and simple to cook.`;

  const response = await client.chat.completions.create({
    model: "gpt-4o-mini",
    messages: [{ role: "user", content: prompt }],
    temperature: 0.7
  });

  const recipe = response.choices[0].message.content;

  return Response.json({ recipe });
}
